"use strict";(self.webpackChunksgpp_tech_guide=self.webpackChunksgpp_tech_guide||[]).push([[855],{1023:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"adrs/mensageria","title":"ADR-006 \u2013 Mensageria e publica\xe7\xe3o de eventos (Kafka / pub-sub)","description":"- Status: Accepted","source":"@site/docs/adrs/0007-mensageria.md","sourceDirName":"adrs","slug":"/adrs/mensageria","permalink":"/sgpp-tech-guide/docs/adrs/mensageria","draft":false,"unlisted":false,"editUrl":"https://github.com/ppsa-sgpp/sgpp-tech-guide/edit/main/docs/adrs/0007-mensageria.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ADR-005 \u2013 Separa\xe7\xe3o dos modelos de dados (Write/Event Log vs Read/Entidades)","permalink":"/sgpp-tech-guide/docs/adrs/separacao-modelos-dados"},"next":{"title":"ADR-007 \u2013 Banco de dados principal: MongoDB","permalink":"/sgpp-tech-guide/docs/adrs/storage"}}');var o=n(5813),i=n(1911);const a={},t="ADR-006 \u2013 Mensageria e publica\xe7\xe3o de eventos (Kafka / pub-sub)",d={},c=[{value:"Contexto",id:"contexto",level:2},{value:"Decis\xe3o",id:"decis\xe3o",level:2},{value:"Consequ\xeancias",id:"consequ\xeancias",level:2},{value:"Rela\xe7\xf5es",id:"rela\xe7\xf5es",level:2}];function l(e){const s={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"adr-006--mensageria-e-publica\xe7\xe3o-de-eventos-kafka--pub-sub",children:"ADR-006 \u2013 Mensageria e publica\xe7\xe3o de eventos (Kafka / pub-sub)"})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Status:"})," Accepted"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Data:"})," 2019-09-06"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"contexto",children:"Contexto"}),"\n",(0,o.jsxs)(s.p,{children:["O Event Store registra eventos de dom\xednio e precisa ",(0,o.jsx)(s.strong,{children:"notificar handlers"})," que rodam em aplica\xe7\xf5es separadas para ",(0,o.jsx)(s.strong,{children:"materializar proje\xe7\xf5es"})," e acionar integra\xe7\xf5es.",(0,o.jsx)(s.br,{}),"\n","Um barramento de eventos com ",(0,o.jsx)(s.strong,{children:"pub/sub, parti\xe7\xf5es e consumer groups"})," atende esse acoplamento fraco e permite ",(0,o.jsx)(s.strong,{children:"escala independente"})," de produtores e consumidores, al\xe9m de abrir espa\xe7o para ",(0,o.jsx)(s.strong,{children:"novos consumidores futuros"})," (auditoria, analytics, integra\xe7\xf5es externas)."]}),"\n",(0,o.jsx)(s.h2,{id:"decis\xe3o",children:"Decis\xe3o"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Adotar ",(0,o.jsx)(s.strong,{children:"Apache Kafka"})," como ",(0,o.jsx)(s.strong,{children:"broker de eventos"})," do SGPP."]}),"\n",(0,o.jsxs)(s.li,{children:["Publicar ",(0,o.jsx)(s.strong,{children:"todo evento confirmado"})," pelo Event Store em ",(0,o.jsx)(s.strong,{children:"t\xf3picos de dom\xednio"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:["Consumidores (handlers) atualizam ",(0,o.jsx)(s.strong,{children:"proje\xe7\xf5es de leitura"})," e executam side-effects quando aplic\xe1vel."]}),"\n",(0,o.jsxs)(s.li,{children:["O ",(0,o.jsx)(s.code,{children:"sgpp-services"})," (ver ADR-014) ",(0,o.jsx)(s.strong,{children:"publica eventos no Kafka"})," ao gravar no Event Store e ",(0,o.jsx)(s.strong,{children:"consome"})," quando atua como handler de proje\xe7\xf5es ou integra\xe7\xf5es."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"consequ\xeancias",children:"Consequ\xeancias"}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.strong,{children:"Positivas"})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Desacoplamento"})," entre escrita e leitura/integra\xe7\xf5es por pub/sub."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Escalabilidade"})," independente de produtores e consumidores via partitions e consumer groups."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Extensibilidade"}),": novos consumidores se conectam sem impactar produtores."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Reprocessamento"})," facilitado por reten\xe7\xe3o e offsets."]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.strong,{children:"Negativas"})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Introduz ",(0,o.jsx)(s.strong,{children:"complexidade operacional"})," (cluster, monitora\xe7\xe3o, tuning)."]}),"\n",(0,o.jsxs)(s.li,{children:["Requer ",(0,o.jsx)(s.strong,{children:"governan\xe7a de contratos de eventos"})," e ",(0,o.jsx)(s.strong,{children:"versionamento"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:["Imp\xf5e ",(0,o.jsx)(s.strong,{children:"consist\xeancia eventual"})," entre Event Store e proje\xe7\xf5es."]}),"\n",(0,o.jsxs)(s.li,{children:["Exige disciplina de ",(0,o.jsx)(s.strong,{children:"idempot\xeancia"})," e tratamento de erros (DLQ, retries)."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"rela\xe7\xf5es",children:"Rela\xe7\xf5es"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"ADR-001 \u2013 Event Sourcing + CQRS"}),": define a necessidade de publicar eventos ap\xf3s o commit no Event Store."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"ADR-006 \u2013 Separa\xe7\xe3o dos modelos de dados"}),": consumidores atualizam ",(0,o.jsx)(s.strong,{children:"proje\xe7\xf5es de leitura"})," a partir dos eventos."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsxs)(s.strong,{children:["ADR-014 \u2013 Consolida\xe7\xe3o no ",(0,o.jsx)(s.code,{children:"sgpp-services"})]}),": o servi\xe7o embarca o Event Store e centraliza publica\xe7\xe3o/consumo."]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},1911:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>t});var r=n(9729);const o={},i=r.createContext(o);function a(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);