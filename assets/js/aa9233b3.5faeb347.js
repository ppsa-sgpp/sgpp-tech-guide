"use strict";(self.webpackChunksgpp_tech_guide=self.webpackChunksgpp_tech_guide||[]).push([[583],{1911:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>t});var r=n(9729);const i={},a=r.createContext(i);function o(e){const s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:s},e.children)}},8693:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"adr/event-sourcing-cqrs","title":"ADR-001 \u2013 Estilo arquitetural: Event Sourcing + CQRS","description":"- Status: Accepted","source":"@site/docs/adr/0002-event-sourcing-cqrs.md","sourceDirName":"adr","slug":"/adr/event-sourcing-cqrs","permalink":"/sgpp-tech-guide/docs/adr/event-sourcing-cqrs","draft":false,"unlisted":false,"editUrl":"https://github.com/ppsa-sgpp/sgpp-tech-guide/edit/main/docs/adr/0002-event-sourcing-cqrs.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ADR-NNN \u2013 T\xedtulo da Decis\xe3o","permalink":"/sgpp-tech-guide/docs/adr/template"},"next":{"title":"ADR-002 \u2013 Orquestra\xe7\xe3o de processos no IBM BAW (BPMN + Coaches)","permalink":"/sgpp-tech-guide/docs/adr/orquestracao-processos"}}');var i=n(5813),a=n(1911);const o={},t="ADR-001 \u2013 Estilo arquitetural: Event Sourcing + CQRS",d={},c=[{value:"Contexto",id:"contexto",level:2},{value:"Decis\xe3o",id:"decis\xe3o",level:2},{value:"Consequ\xeancias",id:"consequ\xeancias",level:2},{value:"Rela\xe7\xf5es",id:"rela\xe7\xf5es",level:2}];function l(e){const s={br:"br",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"adr-001--estilo-arquitetural-event-sourcing--cqrs",children:"ADR-001 \u2013 Estilo arquitetural: Event Sourcing + CQRS"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," Accepted"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Data:"})," 2019-09-01"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"contexto",children:"Contexto"}),"\n",(0,i.jsxs)(s.p,{children:["Um dos requisitos fundamentais do SGPP \xe9 a exist\xeancia de uma ",(0,i.jsx)(s.strong,{children:"trilha completa de auditoria"})," que permita reconstruir e justificar qualquer altera\xe7\xe3o feita nas entidades de neg\xf3cio.",(0,i.jsx)(s.br,{}),"\n","A abordagem tradicional de CRUDs simples n\xe3o atenderia esse requisito, pois grava apenas o estado atual, sem preservar o hist\xf3rico detalhado."]}),"\n",(0,i.jsx)(s.p,{children:"Para atender \xe0 rastreabilidade e auditabilidade regulat\xf3ria, a arquitetura precisava garantir:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Registro imut\xe1vel de todos os eventos de neg\xf3cio."}),"\n",(0,i.jsx)(s.li,{children:"Capacidade de reconstituir estados anteriores de qualquer entidade."}),"\n",(0,i.jsx)(s.li,{children:"Possibilidade de reprocessar eventos em caso de corre\xe7\xf5es ou adapta\xe7\xf5es futuras."}),"\n",(0,i.jsx)(s.li,{children:"Separa\xe7\xe3o clara entre grava\xe7\xe3o (commands) e leitura (queries), evitando sobrecarga de consultas sobre o Event Log."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"decis\xe3o",children:"Decis\xe3o"}),"\n",(0,i.jsxs)(s.p,{children:["Adotar o padr\xe3o ",(0,i.jsx)(s.strong,{children:"Event Sourcing"})," em conjunto com ",(0,i.jsx)(s.strong,{children:"CQRS (Command Query Responsibility Segregation)"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Grava\xe7\xe3o (commands):"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Todas as opera\xe7\xf5es de cria\xe7\xe3o e atualiza\xe7\xe3o passam pelo ",(0,i.jsx)(s.strong,{children:"Event Store Service"}),", que recebe comandos e faz o ",(0,i.jsx)(s.em,{children:"check-in"})," de acordo com a vers\xe3o atual da entidade."]}),"\n",(0,i.jsxs)(s.li,{children:["O Event Store registra o evento no ",(0,i.jsx)(s.strong,{children:"Event Log"})," e publica uma mensagem no ",(0,i.jsx)(s.strong,{children:"Kafka"})," (Message Hub)."]}),"\n",(0,i.jsx)(s.li,{children:"A grava\xe7\xe3o \xe9 sempre feita via eventos, n\xe3o por atualiza\xe7\xe3o direta em cole\xe7\xf5es."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Leitura (queries):"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Handlers ass\xedncronos escutam os eventos publicados no Kafka e atualizam ",(0,i.jsx)(s.strong,{children:"proje\xe7\xf5es"})," otimizadas para consulta."]}),"\n",(0,i.jsx)(s.li,{children:"O frontend e demais servi\xe7os consomem dados exclusivamente a partir dessas proje\xe7\xf5es, evitando consultas caras ao Event Log."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Versionamento:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Foi considerada tamb\xe9m a estrat\xe9gia de ",(0,i.jsx)(s.strong,{children:"duplicar cole\xe7\xf5es"}),", mantendo vers\xf5es de entidades manualmente."]}),"\n",(0,i.jsx)(s.li,{children:"Essa abordagem, embora mais simples de implementar, foi descartada como principal, pois duplica\xe7\xe3o direta geraria redund\xe2ncia e maior risco de inconsist\xeancias."}),"\n",(0,i.jsx)(s.li,{children:"O Event Sourcing foi priorizado por atender melhor \xe0 rastreabilidade e auditabilidade exigida."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"consequ\xeancias",children:"Consequ\xeancias"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Positivas"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Garante ",(0,i.jsx)(s.strong,{children:"trilha completa de auditoria"}),", atendendo requisito regulat\xf3rio."]}),"\n",(0,i.jsxs)(s.li,{children:["Possibilita ",(0,i.jsx)(s.strong,{children:"reconstru\xe7\xe3o de estados anteriores"})," e reprocessamento de eventos."]}),"\n",(0,i.jsxs)(s.li,{children:["Facilita ",(0,i.jsx)(s.strong,{children:"escala de leitura"}),", pois as consultas v\xe3o para proje\xe7\xf5es otimizadas."]}),"\n",(0,i.jsxs)(s.li,{children:["Suporte natural a ",(0,i.jsx)(s.strong,{children:"event-driven architecture"}),", com integra\xe7\xe3o via Kafka."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Negativas"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Demanda por ",(0,i.jsx)(s.strong,{children:"sincroniza\xe7\xe3o robusta"})," entre Event Store e proje\xe7\xf5es (handlers)."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"rela\xe7\xf5es",children:"Rela\xe7\xf5es"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"ADR-006 \u2013 Separa\xe7\xe3o dos modelos de dados (Write/Event Log vs Read/Entidades)"})," detalha a materializa\xe7\xe3o das proje\xe7\xf5es e a distin\xe7\xe3o entre os modelos de leitura e escrita."]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);